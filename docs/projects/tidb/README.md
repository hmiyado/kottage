# TiDB Serverless移行プロジェクト

## 概要

AWS RDSからTiDB Serverlessへの移行プロジェクト。運用コスト削減を目的とする。

## 目標

- **コスト削減**: 月$14.95（年$179）のRDS料金を削減
- **ダウンタイム最小化**: アプリケーション再起動の数秒のみ
- **リスク最小化**: 段階的移行でロールバック可能な状態を維持

## ドキュメント

- [移行計画（詳細版）](./migration-plan.md) - ステップバイステップの移行手順
- [開発ワークフロー](./development-workflow.md) - ブランチ戦略、PR、レビュー、デプロイフロー
- [フェーズ実施報告テンプレート](./phase-reports/TEMPLATE.md) - 各フェーズ完了後の報告用

## プロジェクトステータス

- [ ] フェーズ0: 事前調査
- [ ] フェーズ1: アプリケーションコード修正
- [ ] フェーズ2: TiDB Serverlessセットアップ
- [ ] フェーズ3: ローカル環境でTiDB接続テスト
- [ ] フェーズ4: データ移行準備
- [ ] フェーズ5: TiDBへデータインポート
- [ ] フェーズ6: 本番切り替え
- [ ] フェーズ7: 監視・検証
- [ ] フェーズ8: クリーンアップ

## コスト比較

### 現状（us-east-2）

```text
RDS db.t3.micro:     $14.95/月
EC2 t2.nano:         $5.12/月
VPC (Lambda ENI):    $3.72/月
Route 53:            $0.50/月
合計:                $24.29/月
```

### 移行後（us-east-2 EC2 + us-east-1 TiDB）

```text
TiDB Serverless:     $0/月（無料枠内）
EC2 t2.nano:         $5.12/月
VPC (Lambda ENI):    $3.72/月
Route 53:            $0.50/月
合計:                $9.34/月

削減額: $14.95/月（≒$179/年、62%削減）
```

## 採用戦略

**戦略A: 段階的移行（採用）**
- リージョンはそのまま（us-east-2）
- DBのみTiDB（us-east-1）に切り替え
- ダウンタイム最小、ロールバック容易

## リスク管理

- クロスリージョン通信のレイテンシ: +5-10ms程度（許容範囲）
- 問題発生時は即座にRDSへロールバック可能
- RDSは1週間の監視期間後に削除

## 技術要件

### TiDB Serverless
- リージョン: us-east-1 (N. Virginia)
- 無料枠: 5GB/月 + 5000万RU/月
- 接続: TLS必須、ポート4000

### アプリケーション変更
- SSL/TLS対応
- ポート番号の設定可能化
- 環境変数による柔軟な設定
